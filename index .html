<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ملابس مجانية</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
    header { background:#4CAF50; color:white; padding:20px; text-align:center; }
    .search-bar { margin:20px; text-align:center; }
    .search-bar input { padding:10px; width:300px; }
    .card-container { display:flex; justify-content:center; flex-wrap:wrap; margin:20px; }
    .card { background:white; border:1px solid #ddd; border-radius:5px; margin:10px; padding:10px; width:300px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .card img { width:100%; border-radius:5px; }
    .card h3 { margin:10px 0; }
    .card p { color:grey; }
    .button { display:block; text-align:center; background:#4CAF50; color:white; padding:10px; border-radius:5px; text-decoration:none; margin-top:10px; }
    button.add-post { padding:10px 15px; cursor:pointer; border:none; border-radius:5px; background:#2196F3; color:white; }
  </style>
</head>
<body>

<header>
  <h1>ملابس مجانية</h1>
  <p>ابحث عن الملابس المجانية أو أضف ملابسك</p>
</header>

<div class="search-bar">
  <input type="text" placeholder="ابحث عن نوع الملابس" id="searchInput">
  <button onclick="searchPosts()">بحث</button>
</div>

<h2 style="text-align:center;">أضف ملابس جديدة</h2>
<div style="text-align:center; margin-bottom:20px;">
  <input type="text" id="title" placeholder="اسم القطعة">
  <input type="text" id="owner" placeholder="اسمك">
  <input type="text" id="description" placeholder="وصف الملابس">
  <button class="add-post" onclick="addPost()">إرسال</button>
</div>

<h2 style="text-align:center;">الملابس المتاحة</h2>
<div class="card-container" id="postsContainer"></div>

<script>
  const API = "http://localhost:5000"; // رابط الخادم

  async function loadPosts(){
    try {
      const res = await fetch(`${API}/posts`);
      const data = await res.json();
      renderPosts(data);
    } catch(err){ console.error(err); }
  }

  function renderPosts(posts){
    const container = document.getElementById("postsContainer");
    container.innerHTML = "";
    posts.forEach(post => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${post.title}</h3>
        <p>${post.description}</p>
        <p>بواسطة: ${post.owner}</p>
      `;
      container.appendChild(card);
    });
  }

  async function addPost(){
    const title = document.getElementById("title").value;
    const owner = document.getElementById("owner").value;
    const description = document.getElementById("description").value;
    if(!title || !owner || !description){ alert("اكمل كل الحقول"); return; }

    try {
      const res = await fetch(`${API}/posts`,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ title, owner, description })
      });
      const data = await res.json();
      alert(data.message);
      document.getElementById("title").value="";
      document.getElementById("owner").value="";
      document.getElementById("description").value="";
      loadPosts();
    } catch(err){ console.error(err); }
  }

  function searchPosts(){
    const query = document.getElementById("searchInput").value.toLowerCase();
    const cards = document.getElementById("postsContainer").children;
    Array.from(cards).forEach(card => {
      const title = card.querySelector("h3").textContent.toLowerCase();
      card.style.display = title.includes(query) ? "block" : "none";
    });
  }

  loadPosts();
</script>

</body>
</html>
